@model List<EntityLayer.Concrete.Comment>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

    <div id="wrapper">
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox ">
                            <div class="ibox-title">
                                <h2>Tüm Yorumlar</h2>
                            </div>
                            <div class="ibox-content">

                                <table class="table table-hover table-responsive">
                                    <thead>
                                        <tr>
                                            <th class="text-center">#</th>
                                            <th class="text-center">Kullanıcı</th>
                                            <th class="text-center">Başlık</th>
                                            <th class="text-center">Yorum</th>
                                            <th class="text-center">Tarih</th>
                                            <th class="text-center">Durum</th>
                                            <th class="text-center">Blog Adı</th>
                                            <th class="text-center""">Blog Puanı</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    @foreach( var item in Model)
                                    {
                                        <tr data-comment-id="@item.CommentID">
                                            <td class="text-center" >@item.CommentID</td>
                                            <td class="text-center" >@* <span class="pie">0.52,1.041</span> *@@item.CommentUserName</td>
                                            <td class="text-center" >@item.CommentTitle</td>
                                            <td class="text-center"  >@*  <i class="fa fa-level-up"></i> 40%  *@@item.CommentContent</td>
                                            <td class="text-center" >@(((DateTime)item.CommentDate).ToString("dd-MMM-yyyy"))</td>
                                            <td class="text-center" >@if ( item.CommentStatus )
                                                {
                                                  <div class="d-flex flex-row">
                                                    <button class="status-changer btn btn-info p-1" style="margin-right:0.3em;">AKTİF</button>
                                                    <button class="status-changer btn btn-outline-danger p-1" style="margin-right:0.3em;">PASİF</button>
                                                    <button class="delete-comment btn btn-warning">SİL</button>
                                                  </div>   
                                                } else
                                                {
                                                  <div class="d-flex flex-row">
                                                    <button class="status-changer btn btn-outline-info p-1" style="margin-right:0.3em;">AKTİF</button>
                                                    <button class="status-changer btn btn-danger p-1" style="margin-right:0.3em;">PASİF</button>
                                                    <button class="delete-comment btn btn-warning">SİL</button>
                                                  </div>
                                                }
                                                
                                            </td>
                                            <td class="text-center">@item.Blog.BlogTitle</td>
                                            <td class="text-center" class="text-navy">

                                                @if( item.BlogScore >= 0 && item.BlogScore <= 4 ){

                                                <span class="text-danger">@item.BlogScore</span>

                                            }else if( item.BlogScore > 4 && item.BlogScore < 8)
                                            {
                                                <span class="text-warning">@item.BlogScore</span>
                                                
                                            }else if( item.BlogScore >= 8 ){

                                                <span class="text-info">@item.BlogScore</span>

                                            }

                                            </td>
                                        </tr>
                                    }
                                </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    </div>
   

@section scripts{

    <!-- Mainly scripts -->
    <script src="~/inspinia-gh-pages/js/jquery-3.1.1.min.js"></script>
    <script src="~/inspinia-gh-pages/js/popper.min.js"></script>
    <script src="~/inspinia-gh-pages/js/bootstrap.js"></script>
    <script src="~/inspinia-gh-pages/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="~/inspinia-gh-pages/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <script>
        $(document).ready( function(){

            $('.delete-comment').click( function(){

                var row = $(this).closest('tr');

                var commentId = row.attr('data-comment-id');

                Swal.fire({

                    title: "Silmek İstediğine Emin Misin?",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Evet",
                    cancelButtonText: "Vazgeç"

                }).then((result) => {
                    if (result.isConfirmed) {

                        $.ajax({

                            url: '/Admin/AdminComment/DeleteComment',
                            type: 'POST',
                            data: { id: commentId },
                            success: function (data) {

                                console.log(data);

                                Swal.fire({
                                    title: "Silme İşlemi Başarılı",
                                    icon: "success",
                                    showConfirmButton: false
                                });

                                setTimeout(function () {
                                    window.location.href = "/Admin/AdminComment/";
                                }, 1000);

                            },
                            error: function (xhr, status, error) {

                                console.log(xhr + "," + status + "," + error);

                                Swal.fire({
                                    title: "Silme işlemi başarısız",
                                    icon: "warning",
                                    confirmButtonText: "Tamam",
                                    confirmButtonColor: "#3085d6"
                                });

                            }

                        })

                    }
                })

            } )

            $( '.status-changer' ).click( function(){

                var row = $(this).closest('tr');
                var commentId = row.attr('data-comment-id');

                console.log( commentId );

                $.ajax({
                    url: '/Admin/AdminComment/ChangeCommentStatus/',
                    type: 'POST',
                    data: { id: commentId },
                    success: function( data ){
                    
                        console.log(data);

                        window.location.href = "/Admin/AdminComment/";

                    },
                    error: function( xhr, status, error ){

                        console.log( xhr + "," + status + "," + error );

                    }
                })

            } )


        } )
    </script>

}
