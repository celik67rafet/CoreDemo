
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/AdminLayout.cshtml";
}

<!-- NUMBER INPUT ATTIR-AZALT BUTON KALDIRMA CSS BAŞLANGIÇ -->

<style>
    /* Sayı giriş kutusunun arttırma/azaltma butonlarını gizleme */
    .no-spinner {
        -moz-appearance: textfield; /* Firefox için */
        -webkit-appearance: none; /* Chrome, Safari, ve Opera için */
        appearance: none; /* Diğer tarayıcılar için */
    }

        .no-spinner::-webkit-inner-spin-button,
        .no-spinner::-webkit-outer-spin-button {
            -webkit-appearance: none; /* Chrome, Safari, ve Opera için */
            margin: 0; /* Butonlar için boşluk ayarı */
        }
</style>

<!-- NUMBER INPUT ATTIR-AZALT BUTON KALDIRMA CSS BİTİŞ -->


<h1>Yazar Ajax İşlemleri</h1>

<br />

<button type="button" id="btnGetList" class="btn btn-outline-primary">Yazar Listesi</button>
<button type="button" id="btnGetById" class="btn btn-outline-success">Yazar Getir</button>
<button type="button" id="btnAddWriter" class="btn btn-outline-info">Yazar Ekle</button>
<button type="button" id="btnDeleteWriter" class="btn btn-outline-danger">Yazar Sil</button>
<button type="button" id="btnUpdateWriter" class="btn btn-outline-dark">Yazar Güncelle</button>

<br />
<br />

@* <div>
    <input type="number" class="form-control w-25" name="name" id="writerId" value="" placeholder="Id giriniz" />
    <input type="number" id="writerId" class="form-control no-spinner w-25" placeholder="Id giriniz">
</div> *@
<br />
<div>
    <input type="text" class="form-control" id="txtWriterId" placeholder="Yazar ID"/>
    <br />
    <input type="text" class="form-control" id="txtWriterName" placeholder="Yazar Adı"/>
</div>
<br />
<div id="writer">
</div>
<br />
<div id="writerList"></div>

@section scripts{

    <!-- Mainly scripts -->
    <script src="~/inspinia-gh-pages/js/jquery-3.1.1.min.js"></script>
    <script src="~/inspinia-gh-pages/js/popper.min.js"></script>
    <script src="~/inspinia-gh-pages/js/bootstrap.js"></script>
    <script src="~/inspinia-gh-pages/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="~/inspinia-gh-pages/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <script>

        $("#btnGetList").click( function(){

            console.log("debug başladı...");

            $.ajax( { 
            
                contentType: "application/json",
                dataType: "json",
                type: "GET",
                url: "/Admin/Writer/WriterList",
                success: function ( data ) {

                    let w = jQuery.parseJSON( data )

                    console.log( w );

                    let tableHtml = "<div class='table-responsive'>"

                    tableHtml += "<table id='writerTable' class='table table-bordered'>"
                        + "<tr>"
                        + "<th class='text-center'>YazarID</th>"
                        + "<th class='text-center'>YazarAdı</th>"
                        + "<tr>";

                    $.each(w , (index, value) => {
                        
                        tableHtml += `<tr data-id="${ value.Id }" data-name="${ value.Name }">
                        
                            <td class="text-center">${ value.Id }</td>
                            <td class="text-center">${ value.Name }</td>
                        
                            </tr>
                        `

                    })

                    tableHtml += "</table>";
                    tableHtml += "</div>";

                    $("#writerList").html( tableHtml );

                    $("#writerTable tr").on('click', function () {

                        $( "#writerTable tr" ).removeClass( "bg bg-info" );
                        // Satırın içindeki verileri almak için
                        let writerId = $( this ).data( "id" );
                        let writerName = $( this ).data( "name" );

                        console.log("Yazar ID: " + writerId);
                        console.log("Yazar Adı: " + writerName);

                        $( '#txtWriterId' ).val( writerId );
                        $( '#txtWriterName' ).val( writerName );

                        $( this ).addClass("bg bg-info");
                    });

                    
                }
            
            } );

        } );

        $("#btnGetById").click(x => {

            let id = $("#writerId").val()

            $.ajax({

                contentType: "application/json",
                dataType: "json",
                type: "GET",
                url: "/Admin/Writer/GetWriterById/",
                data: { writerId: id },
                success: function ( data ) 
                {

                    var w = jQuery.parseJSON(data);

                    if (w == null) {

                        console.log("null ulan");

                        $('#writer').html('<p>Böyle Bir Kayıt Yok</p>');
                        
                    }else{
                        
                        let w = jQuery.parseJSON( data );

                        let getValue = ` 
                        
                        <div class="table-responsive">
                            <table class='table table-bordered'>
                                <tr>
                                    <th class='text-center'>Yazar ID</th>
                                    <th class='text-center'>Yazar Adı</th>
                                </tr>
                                <tr>
                                    <td class="text-center">${ w.Id }</td>
                                    <td class="text-center">${ w.Name }</td>
                                </tr>
                            </table> 
                         </div>`;

                        $( '#writer' ).html( getValue );
                    
                    }

                }


            })


        } )

        $("#btnAddWriter").click( function(){

            let writer = {

                Id: $( "#txtWriterId" ).val(),
                Name: $( "#txtWriterName" ).val()

            };

            $.ajax({

                type: "post",
                url: "/Admin/Writer/AddWriter/",
                data: writer,
                success: function( data ){

                    let result = jQuery.parseJSON( data );
                    alert("Yazar Ekleme İşlemi Başarılı Bir Şekilde Gerçekleşti");

                }

            })

        } )

        $("#btnDeleteWriter").click(function () {

            let id = $('#txtWriterId').val();

            console.log("ID değeri:", id);  // Konsolda doğru çıktıyı kontrol edin

            if (!id) {
                alert("ID boş olamaz");
                return;
            }

            $.ajax({
                url: "/Admin/Writer/DeleteWriter",
                type: "POST",
                data: { writerId: id },
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    alert(data.message);
                },
                error: function () {
                    alert("Bir hata oluştu.");
                }
            });
        });

        $("#btnUpdateWriter").click(function () {

            let writer = {

                Id: $("#txtWriterId").val(),
                Name: $("#txtWriterName").val()

            };

            $.ajax({

                type: "post",
                url: "/Admin/Writer/UpdateWriter",
                data: writer,
                success: function ( data ){

                    alert( "Güncelleme başarılı" );

                }

            })

        } )

    </script>

}

